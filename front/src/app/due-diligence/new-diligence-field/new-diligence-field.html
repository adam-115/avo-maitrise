<div class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex justify-center items-center z-50 p-4">
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden border border-slate-200">

    <div class="bg-slate-50 border-b border-slate-100 p-5">
      <h2 class="text-xl font-bold text-slate-800 flex items-center gap-3">
        <span class="p-2 bg-cyan-100 text-cyan-600 rounded-lg shadow-sm">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
          </svg>
        </span>
        Nouveau champ de formulaire
      </h2>
    </div>

    <form [formGroup]="fieldForm" (ngSubmit)="onSubmit()" class="p-6 space-y-5">

      <div>
        <label class="block text-sm font-bold text-slate-700 mb-1.5 px-0.5">Libellé du champ <span
            class="text-cyan-500">*</span></label>
        <input formControlName="label" type="text" placeholder="ex: Quel est votre ville ?"
          class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-4 focus:ring-cyan-500/10 focus:border-cyan-500 transition-all outline-none font-medium placeholder:text-slate-400">
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-bold text-slate-700 mb-1.5 px-0.5">Type d'élément</label>
          <select formControlName="type"
            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-4 focus:ring-cyan-500/10 focus:border-cyan-500 transition-all outline-none appearance-none font-medium text-slate-700 cursor-pointer">
            <option value="text">Texte Court</option>
            <option value="textarea">Zone de texte</option>
            <option value="select">Liste déroulante</option>
            <option value="radio">Bouton Radio</option>
            <option value="checkbox">Case à cocher</option>
          </select>
        </div>
        <div class="flex items-end pb-3">
          <label class="relative inline-flex items-center cursor-pointer group">
            <input type="checkbox" formControlName="required" class="sr-only peer">
            <div
              class="w-11 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-500 shadow-inner">
            </div>
            <span
              class="ml-3 text-sm font-bold text-slate-600 group-hover:text-cyan-600 transition-colors">Obligatoire</span>
          </label>
        </div>
      </div>

      <div *ngIf="['select', 'radio', 'checkbox'].includes(fieldForm.get('type')?.value)"
        class="bg-cyan-50/30 border border-cyan-100 rounded-2xl p-4 animate-in fade-in slide-in-from-top-2 duration-300">

        <div class="flex justify-between items-center mb-3">
          <label class="text-xs font-black text-cyan-800 uppercase tracking-widest">Gestion des options</label>

          <label
            class="cursor-pointer bg-white border border-cyan-200 text-cyan-600 px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-cyan-500 hover:text-white transition-all flex items-center gap-2 shadow-sm uppercase tracking-wide">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
            </svg>
            Import CSV
            <input type="file" (change)="onCsvUpload($event)" accept=".csv,.txt" class="hidden">
          </label>
        </div>

        <div class="flex gap-2 mb-4">
          <input type="text" formControlName="option" placeholder="Ajouter manuellement..."
            class="flex-1 px-4 py-2 bg-white border border-cyan-100 rounded-xl text-sm focus:ring-2 focus:ring-cyan-200 outline-none font-medium placeholder:text-slate-300 text-slate-700">
          <button type="button" (click)="addOption()"
            class="bg-cyan-500 text-white px-4 py-2 rounded-xl hover:bg-cyan-600 transition-all shadow-md shadow-cyan-500/20 text-sm font-black">
            +
          </button>
        </div>

        <div class="max-h-40 overflow-y-auto space-y-2 pr-2 custom-scrollbar">
          @for (option of options; track $index) {
          <div
            class="flex items-center justify-between bg-white p-2.5 rounded-xl border border-slate-100 group shadow-sm hover:border-cyan-100 transition-colors">
            <span class="text-sm text-slate-700 font-bold ml-1">{{ option.value }}</span>
            <button type="button" (click)="options.splice($index, 1)"
              class="text-slate-300 hover:text-red-500 transition-colors p-1 bg-slate-50 rounded-lg hover:bg-red-50">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
            </button>
          </div>
          }
        </div>
      </div>

      <div *ngIf="fieldForm.get('required')?.value" class="animate-in zoom-in-95 duration-200">
        <label class="block text-sm font-semibold text-slate-700 mb-1.5">Message d'erreur</label>
        <input formControlName="errorMessage" type="text"
          class="w-full px-4 py-2.5 bg-red-50/30 border border-red-100 rounded-xl text-red-600 placeholder:text-red-300 text-sm italic outline-none focus:border-red-300 transition-all">
      </div>

      <div class="flex justify-end gap-3 mt-8 pt-6 border-t border-slate-100">
        <button type="button" (click)="close.emit()"
          class="px-5 py-3 text-sm font-bold text-slate-500 hover:bg-slate-100 rounded-xl transition-all">
          Annuler
        </button>
        <button type="submit" [disabled]="fieldForm.invalid"
          class="px-8 py-3 bg-slate-900 text-cyan-400 text-sm font-black rounded-xl hover:bg-slate-800 shadow-lg shadow-slate-200 disabled:opacity-30 disabled:shadow-none transition-all uppercase tracking-wide transform hover:-translate-y-0.5">
          Enregistrer le champ
        </button>
      </div>
    </form>
  </div>
</div>