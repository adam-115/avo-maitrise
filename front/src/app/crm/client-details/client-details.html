<div class="p-6 sm:p-10 bg-gray-50 min-h-screen" *ngIf="client">

    <div class="mb-8 border-b border-gray-200 pb-4 flex justify-between items-end">
        <div>
            <nav class="text-sm font-medium text-gray-500 mb-2">
                <a routerLink="/contacts" class="hover:text-cyan-600">Gestion des Contacts</a> /
                <span class="text-slate-800 font-semibold">{{ client.name }}</span>
            </nav>
            <h1 class="text-3xl font-bold text-slate-800 flex items-center">
                {{ client.name }} <span *ngIf="client.type === 'PERSONNE'">, {{ client.firstName }}</span>
                <span class="ml-4 px-3 py-1 text-sm font-semibold rounded-full" [ngClass]="{
                      'bg-purple-100 text-purple-800': client.type === 'SOCIETE',
                      'bg-blue-100 text-blue-800': client.type === 'PERSONNE',
                      'bg-gray-100 text-gray-800': client.type === 'INSTITUTION'
                    }">
                    {{ client.type }}
                </span>
            </h1>
            <p class="text-gray-600 mt-1">
                R√¥le Principal : <span class="font-semibold text-slate-800">{{ client.role }}</span>
            </p>
        </div>

        <div class="flex space-x-3">
            <button (click)="startComplianceReview()"
                class="px-5 py-2.5 rounded-lg text-sm font-medium text-red-700 bg-red-100 hover:bg-red-200 transition duration-150 border border-red-300">
                Lancer une Nouvelle Revue AML
            </button>
            <button (click)="editClient()"
                class="px-5 py-2.5 rounded-lg text-sm font-medium text-white bg-cyan-600 shadow-md hover:bg-cyan-700 transition duration-150">
                √âditer la Fiche
            </button>
        </div>
    </div>

    <div class="p-4 rounded-xl border-l-4 mb-8" [ngClass]="{
           'bg-red-50 border-red-600': client.amlRisk === 'ELEVEE',
           'bg-yellow-50 border-yellow-600': client.amlRisk === 'MOYEN',
           'bg-green-50 border-green-600': client.amlRisk === 'FAIBLE' || client.amlRisk === 'NUL'
         }">
        <div class="flex items-center space-x-3">
            <svg *ngIf="client.amlRisk === 'ELEVEE'" class="w-6 h-6 text-red-600" fill="currentColor"
                viewBox="0 0 20 20">
                <path fill-rule="evenodd"
                    d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                    clip-rule="evenodd"></path>
            </svg>
            <svg *ngIf="client.amlRisk === 'MOYEN'" class="w-6 h-6 text-yellow-600" fill="currentColor"
                viewBox="0 0 20 20">
                <path fill-rule="evenodd"
                    d="M8.257 3.345A4.004 4.004 0 0111.743 3.345c1.458 1.458 1.458 3.824 0 5.282l-3.232 3.232a4.004 4.004 0 01-5.282-5.282c1.458-1.458 3.824-1.458 5.282 0l3.232 3.232a2.002 2.002 0 002.83 0l-1.414-1.414a.5.5 0 00-.707 0L9.423 7.618a.5.5 0 010 .707L8.71 9.043a2.002 2.002 0 00-2.83 0l-3.232-3.232a2.002 2.002 0 012.83-2.83l3.232 3.232a.5.5 0 00.707 0l1.414-1.414a4.004 4.004 0 010-5.657z"
                    clip-rule="evenodd"></path>
            </svg>
            <svg *ngIf="client.amlRisk === 'FAIBLE' || client.amlRisk === 'NUL'" class="w-6 h-6 text-green-600"
                fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd"
                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                    clip-rule="evenodd"></path>
            </svg>

            <h3 class="text-xl font-bold">Risque AML Global :
                <span [ngClass]="{
                    'text-red-700': client.amlRisk === 'ELEVEE',
                    'text-yellow-700': client.amlRisk === 'MOYEN',
                    'text-green-700': client.amlRisk === 'FAIBLE' || client.amlRisk === 'NUL'
                }">
                    {{ client.amlRisk }}
                </span>
            </h3>
        </div>
        <p class="mt-2 text-sm" [ngClass]="{
             'text-red-700': client.amlRisk === 'ELEVEE',
             'text-yellow-700': client.amlRisk === 'MOYEN',
             'text-green-700': client.amlRisk === 'FAIBLE' || client.amlRisk === 'NUL'
           }">
            Statut de Conformit√© KYC : **{{ client.complianceStatus }}** (Derni√®re validation : {{ client.validationDate
            | date: 'dd/MM/yyyy' }})
        </p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

        <div class="lg:col-span-1 space-y-8">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-slate-800 border-b pb-2 mb-4 text-cyan-700">1. Coordonn√©es &
                    Identification</h2>

                <div *ngIf="client.type === 'PERSONNE'" class="space-y-3 text-sm">
                    <p><strong>Nom Complet :</strong> {{ client.name }} {{ client.firstName }}</p>
                    <p><strong>Pays :</strong> {{ client.country }}</p>
                    <p *ngIf="client.sector"><strong>Secteur :</strong> {{ client.sector }}</p>
                    <p><strong>N¬∞ CNI/Passeport :</strong> [DONN√âE MASQU√âE]</p>
                </div>

                <div *ngIf="client.type === 'SOCIETE'" class="space-y-3 text-sm">
                    <p><strong>D√©nomination :</strong> {{ client.name }}</p>
                    <p><strong>Forme Juridique :</strong> {{ client.legalForm }}</p>
                    <p><strong>N¬∞ SIREN/Identifiant :</strong> {{ client.siren }}</p>
                    <p><strong>Pays d'Enregistrement :</strong> {{ client.country }}</p>
                </div>

                <div *ngIf="client.type === 'INSTITUTION'" class="space-y-3 text-sm">
                    <p><strong>Nom de l'Institution :</strong> {{ client.name }}</p>
                    <p><strong>Cat√©gorie :</strong> {{ client.role }}</p>
                    <p><strong>Localisation :</strong> {{ client.country }}</p>
                </div>

                <div class="mt-4 border-t pt-4 space-y-3 text-sm">
                    <p><strong>Email :</strong> <a href="mailto:{{ client.email }}"
                            class="text-blue-600 hover:underline">{{ client.email }}</a></p>
                    <p><strong>T√©l√©phone :</strong> {{ client.phone }}</p>
                    <p><strong>Adresse :</strong> {{ client.address }}</p>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-slate-800 border-b pb-2 mb-4 text-indigo-700">Statistiques Cl√©s</h2>

                <div class="grid grid-cols-2 gap-4 text-center">
                    <div class="p-4 bg-indigo-50 rounded-lg">
                        <p class="text-3xl font-bold text-indigo-800">{{ client.activeCases }}</p>
                        <p class="text-sm text-indigo-700 mt-1">Dossiers Actifs üíº</p>
                    </div>
                    <div class="p-4 bg-indigo-50 rounded-lg">
                        <p class="text-3xl font-bold text-indigo-800">{{ client.totalFiles }}</p>
                        <p class="text-sm text-indigo-700 mt-1">Fichiers Totaux üìÅ</p>
                    </div>
                </div>

                <div class="mt-4 border-t pt-4">
                    <p class="text-xs text-gray-500">Un total de **{{ client.totalFiles }}** documents/communications
                        archiv√©s pour ce contact.</p>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-slate-800 border-b pb-2 mb-4 text-blue-700">Points de Contact</h2>

                <div class="grid grid-cols-2 gap-4 text-center">
                    <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <p class="text-3xl font-bold text-blue-800">{{ client.clientContactsCount }}</p>
                        <p class="text-sm text-blue-700 mt-1">C√¥t√© Client/Entit√© üìû</p>
                    </div>
                    <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <p class="text-3xl font-bold text-blue-800">{{ client.internalContactsCount }}</p>
                        <p class="text-sm text-blue-700 mt-1">Collaborateurs Impliqu√©s üë•</p>
                    </div>
                </div>
                <button class="mt-4 w-full text-center text-sm text-blue-600 hover:text-blue-800 font-medium">Voir la
                    liste des contacts li√©s ‚Üí</button>
            </div>
        </div>

        <div class="lg:col-span-2 space-y-8">
            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-red-500">
                <h2 class="text-xl font-bold text-slate-800 border-b pb-2 mb-4 text-red-700">3. Analyse D√©taill√©e
                    AML/KYC</h2>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center mb-6">
                    <div class="p-4 rounded-lg border">
                        <p class="text-xs text-gray-500 font-medium uppercase">Origine des Fonds</p>
                        <p class="mt-1 font-bold text-lg text-slate-800">{{ client.fundsOrigin }}</p>
                    </div>

                    <div class="p-4 rounded-lg border"
                        [ngClass]="client.isPEP ? 'bg-red-50 border-red-400' : 'bg-green-50 border-green-400'">
                        <p class="text-xs text-gray-500 font-medium uppercase">Personne Politiquement Expos√©e (PPE)</p>
                        <p class="mt-1 font-bold text-lg" [ngClass]="client.isPEP ? 'text-red-700' : 'text-green-700'">
                            {{ client.isPEP ? 'OUI / LI√â' : 'NON' }}
                        </p>
                    </div>

                    <div *ngIf="client.type === 'SOCIETE'" class="p-4 rounded-lg border">
                        <p class="text-xs text-gray-500 font-medium uppercase">B√©n√©ficiaires Effectifs (B.E.)</p>
                        <p class="mt-1 text-sm font-bold text-slate-800 line-clamp-2">{{ client.beneficialOwners }}</p>
                    </div>

                    <div *ngIf="client.type !== 'SOCIETE'" class="p-4 rounded-lg border bg-gray-50">
                        <p class="text-xs text-gray-500 font-medium uppercase">Non Applicable</p>
                        <p class="mt-1 font-bold text-sm text-gray-400">Pour Personnes Physiques / Institutions</p>
                    </div>
                </div>

                <div>
                    <h3 class="font-bold text-lg text-slate-800 mt-4 mb-2">Notes de Diligence Due (V√©rification
                        Compliance)</h3>
                    <div
                        class="bg-gray-100 p-4 rounded-lg border border-gray-200 text-sm italic text-gray-700 whitespace-pre-line">
                        {{ client.complianceNotes || 'Aucune note de diligence sp√©cifique enregistr√©e.' }}
                    </div>

                    <p class="text-xs text-gray-500 mt-3">
                        **Valid√© par :** [Nom de l'Agent/Responsable Compliance] le {{ client.validationDate | date:
                        'dd/MM/yyyy' }}
                    </p>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-slate-800 border-b pb-2 mb-4 text-green-700">2. Acc√®s Documents &
                    Archivage</h2>

                <div class="space-y-3 text-sm">
                    <div class="flex justify-between items-center py-2 border-b">
                        <span class="font-medium">Dossier Num√©rique Complet</span>
                        <a href="/dossier/{{ client.id }}" target="_blank"
                            class="text-cyan-600 hover:text-cyan-800 font-semibold flex items-center">
                            Acc√©der au Dossier ({{ client.totalFiles }} Fichiers)
                            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14">
                                </path>
                            </svg>
                        </a>
                    </div>

                    <div class="flex justify-between items-center py-2 border-b"
                        [ngClass]="client.documentsToReview > 0 ? 'bg-red-50 p-2 -mx-2 rounded' : ''">
                        <span class="font-medium text-slate-700">Documents √† R√©viser/Valider</span>
                        <span *ngIf="client.documentsToReview > 0" class="text-red-600 font-bold flex items-center">
                            üö® {{ client.documentsToReview }} document(s)
                        </span>
                        <span *ngIf="client.documentsToReview === 0" class="text-green-600">
                            Aucun en attente
                        </span>
                    </div>

                    <div class="flex justify-between items-center py-2">
                        <span class="font-medium">Statut d'Archivage Physique</span>
                        <span class="px-3 py-1 text-xs font-semibold rounded-full" [ngClass]="{
                                'bg-green-100 text-green-800': client.archivingStatus === 'COMPLETED',
                                'bg-yellow-100 text-yellow-800': client.archivingStatus === 'PENDING'
                            }">
                            {{ client.archivingStatus === 'COMPLETED' ? 'COMPLET' : 'EN ATTENTE' }}
                        </span>
                    </div>

                    <div *ngIf="client.archivingStatus === 'PENDING'" class="mt-2 text-xs text-yellow-700">
                        * L'archivage physique du Kbis/CNI est toujours requis.
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-slate-800 border-b pb-2 mb-4 text-blue-700">4. Historique des Revues
                    AML</h2>
                <ul class="space-y-3 text-sm">
                    <li class="flex justify-between items-center p-2 rounded-lg hover:bg-blue-50">
                        <span class="font-medium text-slate-700">Revue Annuelle (2024) - **ALERTE**</span>
                        <span class="text-xs text-gray-500">Motif : Lien PPE V√©rifi√©.</span>
                        <span class="text-blue-600 font-medium">Consulter le Rapport (PDF)</span>
                    </li>
                    <li class="flex justify-between items-center p-2 rounded-lg hover:bg-blue-50">
                        <span class="font-medium text-slate-700">Revue Initiale (2022) - **MOYEN**</span>
                        <span class="text-xs text-gray-500">Motif : KYC incomplet.</span>
                        <span class="text-blue-600 font-medium">Consulter le Rapport (PDF)</span>
                    </li>
                </ul>
                <p class="text-sm text-gray-500 mt-4">
                    La prochaine revue de vigilance est pr√©vue pour le **{{ client.validationDate | date: 'longDate'
                    }}**.
                </p>
            </div>
        </div>

    </div>

</div>