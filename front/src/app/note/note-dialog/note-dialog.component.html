<div id="note-creation-modal"
  class="fixed inset-0 z-50 overflow-y-auto bg-gray-900/50 flex items-center justify-center">

  <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg mx-4 my-8 transform transition-all scale-100 opacity-100"
    role="dialog" aria-modal="true" aria-labelledby="modal-title">

    <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center bg-cyan-50 rounded-t-xl">
      <h3 id="modal-title" class="text-xl font-semibold text-slate-800">
        {{ noteToEdit ? 'Modifier la Note' : 'Créer une Nouvelle Note' }}
      </h3>
      <button type="button" (click)="closeNoteDialog()" class="text-gray-400 hover:text-gray-600 transition">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <div class="p-6">
      <form id="note-form" [formGroup]="noteForm" (ngSubmit)="submitForm()" class="space-y-5">

        <div>
          <label for="categoryId" class="block text-sm font-medium text-gray-700 mb-1">Catégorie <span
              class="text-red-500">*</span></label>
          <select id="categoryId" formControlName="categoryId"
            class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-cyan-500 focus:ring-cyan-500 p-2.5">
            <option value="" disabled selected>Sélectionner une catégorie</option>
            @for (category of noteCategories; track category.id) {
            <option [value]="category.id">{{ category.label }}</option>
            }
          </select>
          @if(noteForm.get('categoryId')?.invalid && noteForm.get('categoryId')?.touched) {
          <span class="text-red-500 text-xs mt-1 block">La catégorie est requise.</span>
          }
        </div>

        <div>
          <label for="titre" class="block text-sm font-medium text-gray-700 mb-1">Titre de la Note <span
              class="text-red-500">*</span></label>
          <input type="text" formControlName="titre" id="titre" required
            placeholder="Ex: Mémorandum, Réunion stratégie 04/10"
            class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-cyan-500 focus:ring-cyan-500 p-2.5">
          @if(noteForm.get('titre')?.invalid && noteForm.get('titre')?.touched) {
          <span class="text-red-500 text-xs mt-1 block">Le titre est requis (min 3 caractères).</span>
          }
        </div>

        <div>
          <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Contenu de la Note <span
              class="text-red-500">*</span></label>
          <textarea id="description" formControlName="description" rows="6" required
            placeholder="Saisissez ici les points de discussion, les idées, ou le résumé d'une conversation..."
            class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-cyan-500 focus:ring-cyan-500 p-2.5"></textarea>
          @if(noteForm.get('description')?.invalid && noteForm.get('description')?.touched) {
          <span class="text-red-500 text-xs mt-1 block">La description est requise (min 3 caractères).</span>
          }
        </div>

        <div class="grid grid-cols-2 gap-4">
          <!-- Priority ID (Since priorityId exists in noteForm, we need an input for it, or hardcode/hide it if not needed visually) -->
          <!-- You have priorityId in your ts form block, so let's add a simple priority selector so the form can become valid 
               Or a hidden input if it's not meant to be changed here. I will add a visible generic selector for completeness 
               so that `this.noteForm.valid` evaluates to true! -->
          <!-- <div>
            <label for="priorityId" class="block text-sm font-medium text-gray-700 mb-1">Niveau de Priorité <span
                class="text-red-500">*</span></label>
            <select id="priorityId" formControlName="priorityId"
              class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-cyan-500 focus:ring-cyan-500 p-2.5">
              <option value="" disabled selected>Sélectionner une priorité</option>
              <option value="1">Basse</option>
              <option value="2">Normale</option>
              <option value="3">Haute</option>
              <option value="4">Urgente</option>
            </select>
            @if(noteForm.get('priorityId')?.invalid && noteForm.get('priorityId')?.touched) {
            <span class="text-red-500 text-xs mt-1 block">La priorité est requise.</span>
            }
          </div> -->
        </div>

      </form>
    </div>

    <div class="px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end space-x-3 rounded-b-xl">
      <button type="button" (click)="closeNoteDialog()"
        class="px-5 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-100 transition duration-150">
        Annuler
      </button>
      <button type="button" (click)="submitForm()" [disabled]="!noteForm.valid"
        class="px-5 py-2 border border-transparent rounded-lg text-sm font-medium text-white shadow-md transition duration-150"
        [ngClass]="noteForm.valid ? 'bg-cyan-600 hover:bg-cyan-700 cursor-pointer' : 'bg-gray-400 cursor-not-allowed'">
        {{ noteToEdit ? 'Mettre à jour la Note' : 'Enregistrer la Note' }}
      </button>
    </div>

  </div>
</div>